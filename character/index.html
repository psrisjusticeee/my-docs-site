<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Character - 今夜或不再</title><link rel=stylesheet href=../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../assets/stylesheets/palette.ab4e12ef.min.css><link rel=stylesheet href=../styles.css><link rel=stylesheet href=../epigraph.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=light-blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=.. title=今夜或不再 class="md-header__button md-logo" aria-label=今夜或不再 data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 今夜或不再 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Character </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=light-blue aria-label=切换到夜间模式 type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title=切换到夜间模式 for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=blue-grey data-md-color-accent=teal aria-label=切换到日间模式 type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title=切换到日间模式 for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--integrated" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=今夜或不再 class="md-nav__button md-logo" aria-label=今夜或不再 data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> 今夜或不再 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../ch1/sec-01/ class=md-nav__link> <span class=md-ellipsis> 目录 </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <div class=no-chapter></div> <h1 id=_1>人物谱<a class=headerlink href=#_1 title="Permanent link">&para;</a></h1> <!-- 网络图容器（保留你的高度设定） --> <div id=network style="height:720px; margin: 0.2rem 0 1rem;"></div> <!-- 悬浮卡片（点击节点后在附近显示） --> <div id=char-popover class=char-popover hidden> <button class=char-popover__close aria-label=关闭>×</button> <div class=char-popover__title></div> <div class=char-popover__body></div> </div> <!-- 仅本页用到的悬浮卡片样式 --> <style>
.char-popover{
  position: fixed;                 /* 固定在视口，使用点击坐标定位 */
  left: 0; top: 0;
  transform: translate(-50%, -100%);  /* 默认在点击点的上方稍偏左 */
  width: 22rem;
  max-width: min(22rem, calc(100vw - 1.5rem));
  max-height: min(70vh, 32rem);
  overflow: auto;
  border: 1px solid var(--md-default-fg-color--light, #ddd);
  border-radius: .6rem;
  padding: .8rem 1rem .9rem;
  background: var(--md-default-bg-color, #fff);
  box-shadow: 0 10px 30px rgba(0,0,0,.12), 0 2px 8px rgba(0,0,0,.06);
  z-index: 10000;
}
.char-popover[hidden]{ display:none; }

.char-popover__title{
  font-family: "WenYueGuTiFangSong","AaGuDianKeBenSong","Noto Serif SC",serif;
  font-size: 1.1rem; font-weight: 700; margin-bottom: .35rem;
}
.char-popover__body{
  font-family: "FZSongYi","Noto Serif SC",serif;
  font-size: 1rem; line-height: 1.8;
}

/* 关闭按钮 */
.char-popover__close{
  position: absolute; right: .35rem; top: .2rem;
  border: 0; background: transparent; cursor: pointer;
  font-size: 1.25rem; line-height: 1; color: #666;
}
.char-popover__close:hover{ color:#000; }

/* 暗色模式微调（可选） */
[data-md-color-scheme="slate"] .char-popover{
  border-color: rgba(255,255,255,.18);
  box-shadow: 0 10px 30px rgba(0,0,0,.4), 0 2px 8px rgba(0,0,0,.25);
}
</style> <script>
(function () {
  // === 字体（须与 @font-face 的 font-family 完全一致） ===
  const BODY_FONT  = 'FZSongYi';              // 节点/边标签字体（正文）
  const TITLE_FONT = 'WenYueGuTiFangSong';    // 选中节点/弹窗标题强调

  // === 数据（保持你的原样，不改文案） ===
  const DATA = {
    nodes: [
      { id: 1, label: '吴靖柏' },
      { id: 2, label: '许经纬' },
      { id: 3, label: '许诺' },
      { id: 4, label: '赵书南' },
      { id: 5, label: 'Vincent \n Rejewski' },
      { id: 6, label: '任未央' },
      { id: 7, label: '王和平' },
      { id: 8, label: '谢泯泽' },
      { id: 9, label: '沈凌苍' },
      { id: 10, label: '杨依婷' },
      { id: 11, label: '何雨石' },
      { id: 12, label: '谢子珩' }
    ],
    edges: [
      { from: 1, to: 2, label: '初中同学\n夫妻' },
      { from: 1, to: 3, label: '母女' },
      { from: 2, to: 3, label: '父女' },
      { from: 1, to: 4, label: '高中同桌\n挚友' },
      { from: 1, to: 5, label: '前男友' },
      { from: 2, to: 6, label: '前女友' },
      { from: 1, to: 6, label: '东京大地震\n时相识'},
      { from: 2, to: 5, label: '蓝海项目\n中相识'},
      { from: 1, to: 7, label: '初中同学'},
      { from: 2, to: 7, label: '初中同桌\n朋友'},
      { from: 1, to: 8, label: '亦师亦友'},
      { from: 2, to: 8, label: '师生'},
      { from: 1, to: 9, label: '初中闺蜜'},
      { from: 2, to: 9, label: '初中前后桌'},
      { from: 1, to: 10, label: '高中同学'},
      { from: 2, to: 10, label: '单恋与被单恋'},
      { from: 4, to: 11, label: '前任'},
      { from: 4, to: 12, label: '单恋\n后为前任'},
      { from: 2, to: 12, label: '高一同桌'}
    ],
    bios: {
      1: {
        title: '吴靖柏',
        html: `
          <p>物理学家，VC从业者；古典吉他业余十级，也能弹一点电吉他和贝斯，但极其不喜欢吵闹的摇滚乐；喜欢古典音乐，时常去听音乐会，并收集名家的黑胶唱盘。不喜欢语文课，但高中时期热爱写小说；不喜欢英语课，但在初中时担任了三年的英语课代表。博士五年在东京学会了剑道，用以平心静气，毕业时考过了二段。非常喜欢港剧和港乐，因此耳濡目染地成了粤语半吊子。最喜欢的偶像组合是从小学就开始喜欢的东方神起，最喜欢的歌手是张敬轩和杨千嬅。闲暇时间愿意待在家里一个人看书、写小说，看电影，喜欢东亚文学（尤其是台湾文学，以齐邦媛，白先勇，朱家姐妹为代表）和斯拉夫文学。会看足球，最喜欢的足球运动员是安德烈·舍甫琴科，为此自学了乌克兰语。喜欢白桃乌龙与奶盖的任意组合，对咖啡兴致缺缺。坚信生命在于静止，除了晚饭后快走和游泳之外拒绝任何剧烈运动，在减肥时宁愿饿着也不愿意加大运动量。对许经纬在运动上的持之以恒感到惊奇。</p>
        `
      },
      2: {
        title: '许经纬',
        html: `
          <p>国有银行管培生，后成为高管。小提琴业余九级（最后一级因为升上初中疏于练习而没有继续考）。擅长唱歌，喜欢的歌手是周杰伦和林俊杰。尽管自幼学习的是古典音乐，但颇为喜欢摇滚乐队，有时会去看Live house。喜欢日潮，拉面，是个剑道初学者。因为大学和研究生都在美国度过，对白人饭的接受度良好。与吴靖柏对于奶茶，蛋糕和花哨的咖啡饮料的爱好不同，他热衷于冰美式和黑咖啡。在闲暇时间，他会去健身房运动，能够在增肌减脂期非常好地控制饮食，只吃水煮菜。在香港时偶尔也会夜跑，爬山，生活总体来说非常规律。</p>
        `
      },
      3: {
        title: '许诺',
        html: `
          <p>许经纬与吴靖柏的女儿，2030年12月出生于新加坡。</p>
        `
      },
      4: {
        title: '赵书南',
        html: `
          <p>ENTJ，强势发电机型人物，擅分析、快语速、有目标感。比起吴靖柏更具有领袖人物的风范，对于团队活动更为得心应手。情绪高密度但极具自控力；会开炮，极善于替同是NTJ人的吴靖柏分析拆解局面（反之亦然）。非常讨厌“情绪绕圈子”，热爱打直球，几乎所有的交往对象都是以她先告白而开始。麦肯锡商业分析师，base在上海。擅长整合观点与提出方案，典型Consulting人设，跨越多个行业项目，自带信息通属性。</p>
        `
      },
      5: {
        title: 'Vincent M. Rejewski',
        html: `
          <p>吴靖柏大学时期短暂交往的唯一一个男友（也就是她在和许经纬重新联系彼此报备情史时轻描淡写提起过的存在）。1994年出生于帕罗奥图，美籍波兰裔犹太人，聪明，英俊，性格堪称惹人注目（初识时非常gentleman但其实对人对事的看法都很凌厉，有着学术圈天才非黑即白的特性）。他和吴靖柏在后者大三升大四去UCB上暑校时相识，此时他已经是斯坦福大学的理论高能物理PhD（本科在MIT，拿过国际物理奥林匹克金牌，曾是美国队的国手），来UCB做暑研。专业小细分为高能粒子物理/核聚变物理。课余时间喜欢钻研机械，极其擅长剑道、击剑等技巧与力量并重的运动，也是空手道大师。但不擅长任何需要团队合作的事情。</p>
        `
      },
      6: {
        title: '任未央',
        html: `
          <p>许经纬大学时期短暂交往的唯一一个女友（也就是他在和吴靖柏重新联系彼此报备情史时轻描淡写提起过的存在）。1997年生于中国苏州。艺术家个性，通透练达，习惯并享受人生漂泊不定的过程，会以画画来记录生活。她是许经纬在俄亥俄州立大学的同级生（2016年入学），学的是艺术和商业的交叉学科，对许经纬有印象是因为后者在University shop里见到她时曾经愣住并把她错认成「从前的中学同学」。许经纬不久后即对她说，「希望能交往试试看」，她觉得很有意思，便同意了。但二人由于性格不合+课业紧凑，一个月后便分手。真正令她印象不佳的是许经纬最后的分手理由是一句非常坦白的「对不起，是我拿你做了一个测试」。直到2029年3月东京大地震，她由于写生+采风而滞留当地，在避难所遇见她人生里第二个将她错认成「从前的中学同学」的人——吴靖柏，大学时期那一段短暂的交往背后所埋藏的真相才逐渐浮出水面。</p>
        `
      },
      7: {
        title: '王和平',
        html: `
          <p>许经纬进入延乔中学后的第一个同桌、朋友。各方面都很普通，唯有皮肤黑得出众的高个子男生。性情中庸，酷爱八卦，有点嘴碎，擅长语文和历史，爱打篮球。在初三戏剧节时担纲了剧本的改编工作，留下了一折被老师们评价为「适应于近现代东亚」版的威尼斯商人（吴靖柏饰鲍西娅，许经纬饰巴萨尼奥）。吴靖柏在初一圣诞节送贺卡给许经纬的时候也顺便送了他一张，两人因此变成朋友，他也是最早看出二人之间不寻常端倪的人。曾亲眼目睹吴、许之间的开始，暧昧与决裂，初三时和前座的沈凌苍串通，为缓和两人关系把吴靖柏桌上的牛奶换给了许经纬，没想到她已经打开了那盒牛奶，弄巧成拙。高中也在十三中，并在高二时进入了文科班，QQ签名自此改成“不进培优班不改名”——因此直到毕业都没改名。2015年高考后进入榕城大学，结识了同班同学、后来将成为他妻子的魏采薇。</p>
        `
      },
      8: {
        title: '谢泯泽',
        html: `
          <p>吴靖柏和许经纬的初中物理老师。身量不高，戴副眼镜，但非常聪明。从赣州小县城考入清华物理系并完成本硕学业的高材生，高考时理综接近满分。吴靖柏所在的延乔2012届是他开始中学物理老师生涯后带的第一届学生。非常巧合的是，随着吴靖柏等人升入十三中，他也被从延乔调入十三中，教的先是吴靖柏所在的三班，再是文理分科后她所在的十班。他是吴靖柏的启蒙老师，在初三教会了她「思考物理的正确方式」，帮助她在物理上取得巨大突破、得以考入十三中。在高中时，他负责物理竞赛班的教学，而吴靖柏通过选拔，成为班上为数不多来自平行班的三个人之一。他赏识吴靖柏的天分与努力，鼓励她学习“超纲”的大学物理，包容她尖锐的提问，在发现她在一个问题上正确而自己说错了的时候，客观地在全班面前承认失误。他会在每次月考之后拿吴靖柏的考卷为范本来讲题，会在大考之前拿吴靖柏默写出的知识点来帮大家复习，也会告诫她不要把全部的精力都放在物理上，偏科并不是良策。在吴靖柏苦恼于该如何被外界「看见」的年纪，是他正确的引导让她意识到可以靠自己的努力、智识和天分——简而言之，通过提升自我来实现价值。</p>
        `
      },
      9: {
        title: '沈凌苍',
        html: `
          <p>许经纬和吴靖柏的初中同学，吴靖柏初中时的闺蜜。与吴靖柏这个半吊子好学生不同，从延乔中学到十三中，沈凌苍是真正的资优生，如她的名字所暗示的那样。在延乔中学时，她是在一班（吴靖柏所在的平行班）与培优班之间来回滚动的“局外人”，对吴靖柏的第一印象是「人缘奇好，八卦火热的英语课代表」，对吴靖柏喜欢许经纬这件事的评价是「无法理解你为什么一直对这个人情有独钟」。内向，早熟，高自尊，嘴很毒。私下里喜欢做手工，研究菜谱，喜欢的作家是独木舟，沈从文，余秋雨；与吴靖柏志趣相投，常有书信往来，很快成为闺蜜。她没有亲眼目睹过吴、许二人的故事，只在绯闻中、吴靖柏的信件里听过。但初三时她坐在许经纬（和王和平）的前座，得以近距离观察这位吴靖柏非常喜欢、她却觉得非常普通的男生。曾在初三的戏剧节中饰演尼莉莎一角，旁观吴、许二人作为男女主角的尴尬时刻。2015年进入南开大学数学系，2021年在威斯康星大学麦迪逊分校结束金融硕士的学业之后，克服疫情期间航班熔断的困难回国，进入工商银行深圳分行做文书工作。</p>
        `
      },
      10: {
        title: '杨依婷',
        html: `
          <p>许经纬和吴靖柏的初中、高中同级，吴靖柏进入理科十班之后的同学。初中的同班同学里有后来成为吴靖柏高中最后一任同桌、挚友的祝明渊，以及顾怀桑初中时的女友方宛然。感情经历丰富，几乎一年就能换一个追求的男生，也有很多男性闺蜜、好友，因为「男生相处起来比与女生更自在」。初一时就听过吴靖柏的名字，并且和当时的同桌祝明渊一起去一班的门口悄悄看过她到底是何方神圣。初三时在数学补习班和许经纬第一次说话，并逐渐对他抱有好感。从外人的视角看许经纬和吴靖柏的故事，她注意到吴靖柏从某个阶段开始，在社交场合与许经纬形同陌路，而许经纬并未反击或挽留。加之她曾经在高一的校园歌手大赛上见过许经纬唱歌时的失落，感受到某种“断裂的余温”还留在他的身上。因此她对吴靖柏有一种奇怪、毫无缘由的模仿欲：吴靖柏初一时事无巨细地帮许经纬做功课、签考卷，作业放水这件事几乎人尽皆知，她在高一时便不厌其烦地抄每一门课的笔记给许经纬送下去（因此许经纬也多半要送回她的原本）。而许经纬的不推拒让她看到希望，于是在高一尾声告白，却遭拒。高二文理分科后吴靖柏成为她的同班同学，并因为在物理上的天赋与热情而和她们年轻的物理老师谢泯泽互相欣赏、关系亲近。她将此事鼓吹为一桩绯闻，并非常积极地推广了吴靖柏在高中后期与此相关的外号「谢靖柏」。最后，尽管并不擅长物理，杨依婷在高考后进入天津师范大学时选择了物理系，并在毕业后依靠教工子弟的渠道回到延乔教初中物理。</p>
        `
      }
    }
  };

  // 等待自定义字体加载，避免 canvas 使用回退字体
  async function readyFonts() {
    if (document.fonts && document.fonts.ready) {
      try { await document.fonts.ready; } catch (e) {}
    } else {
      await new Promise(r => setTimeout(r, 300));
    }
  }

  function showPopoverAt(x, y, title, html) {
    const pop = document.getElementById('char-popover');
    const t = pop.querySelector('.char-popover__title');
    const b = pop.querySelector('.char-popover__body');
    t.textContent = title;
    b.innerHTML = html;
    pop.hidden = false;

    // 先放到屏幕中间计算尺寸，再精确定位到点击点附近
    pop.style.left = x + 'px';
    pop.style.top  = y + 'px';

    // 防止越界：把卡片完整放进视口
    const rect = pop.getBoundingClientRect();
    const margin = 8;
    let finalX = x, finalY = y;
    if (rect.right > window.innerWidth - margin) finalX = window.innerWidth - margin - rect.width/2;
    if (rect.left  < margin)                     finalX = margin + rect.width/2;
    if (rect.top   < margin)                     finalY = margin + rect.height;      // 放到点击点下方
    if (rect.bottom> window.innerHeight - margin)finalY = window.innerHeight - margin;

    pop.style.left = finalX + 'px';
    pop.style.top  = finalY + 'px';
  }

  function hidePopover(){
    const pop = document.getElementById('char-popover');
    if (pop) pop.hidden = true;
  }

  async function initNetwork() {
    if (!window.vis) return; // 库未加载
    const el = document.getElementById('network');
    if (!el) return;

    await readyFonts();

    // 清空旧实例（无刷新切页返回时）
    el.innerHTML = "";

    // 数据集
    const nodes = new vis.DataSet(DATA.nodes.map(n => ({
      ...n,
      font: { face: BODY_FONT, size: 18, color: '#222', vadjust: 0 }
    })));
    const edges = new vis.DataSet(DATA.edges);

    const network = new vis.Network(el, { nodes, edges }, {
    layout: { improvedLayout: true, randomSeed: 42 },
    nodes: {
        shape: 'circle',
        size: 36,                              // was ~30 → bigger nodes
        borderWidth: 1.8,
        color: {
        background: '#fff',
        border: '#666',
        highlight: { background: '#f0f6ff', border: '#3f51b5' }
        },
        font: { face: BODY_FONT, size: 20, color: '#222', vadjust: 0 }, // bigger labels
        labelHighlightBold: false
    },
    edges: {
        width: 1.6,
        smooth: { type: 'dynamic', roundness: 0.25 },
        color: { color: 'rgba(136,136,136,.9)', highlight: '#3f51b5' },
        font: {
        face: BODY_FONT, size: 16, align: 'top', vadjust: -12, strokeWidth: 0,
        background: 'rgba(255,255,255,.8)'       // keeps text readable over lines
        },
        selectionWidth: 3,                          // thicker when selected
        hoverWidth: 2,
        chosen: {
        edge: (values, id, selected, hovering) => {
            // Vis will call this to style selected/hovered edges
            if (selected || hovering) {
            values.color = '#e53935';             // highlight color on click/hover
            values.width = 3.2;
            values.shadow = true;
            values.shadowColor = 'rgba(0,0,0,.25)';
            values.shadowSize = 6;
            }
        }
        }
    },
    physics: {
        solver: 'repulsion',
        repulsion: {
        nodeDistance: 150,       // keep the breathing room
        centralGravity: 0.15,
        springLength: 180,
        springConstant: 0.05
        },
        damping: 0.4,
        stabilization: { iterations: 500, fit: true }
    },
    interaction: {
        hover: true, tooltipDelay: 60,
        selectConnectedEdges: true,               // highlights edges connected to a selected node
        zoomView: true, dragView: true,
        minZoom: 0.6, maxZoom: 2.6
    },
    locale: 'zh'
    });

    // Auto-fit, then zoom in a bit for readability
    network.fit({ animation: { duration: 300, easingFunction: 'easeInOutQuad' } });
    //network.moveTo({ scale: 1.2, animation: { duration: 200 } }); // tweak 1.1–1.35 to taste


    // 点击节点 → 在点击位置附近显示悬浮卡片
    network.on('click', params => {
      if (params.nodes && params.nodes.length){
        const id = params.nodes[0];
        const bio = DATA.bios[id];
        if (!bio) return;

        // 选中节点字体强调（保持你的逻辑）
        nodes.update({ id, font: { face: TITLE_FONT, size: 20, color: '#222', vadjust: 0 } });
        nodes.forEach(n => { if (n.id !== id) nodes.update({
          id: n.id, font: { face: BODY_FONT, size: 18, color: '#222', vadjust: 0 }
        })});

        const x = params.event.srcEvent.clientX;
        const y = params.event.srcEvent.clientY;
        showPopoverAt(x, y, bio.title, bio.html);
      } else {
        hidePopover(); // 点击空白处收起
      }
    });

    // ESC 键关闭
    document.addEventListener('keydown', e => { if (e.key === 'Escape') hidePopover(); });
    // 关闭按钮
    document.querySelector('.char-popover__close')
      .addEventListener('click', hidePopover);
  }

  // 首次加载
  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initNetwork);
  else initNetwork();

  // 兼容 Material 的 navigation.instant（无刷新切页）
  if (typeof document$ !== 'undefined') {
    document$.subscribe(initNetwork);
  }
})();
</script> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 J.Y.Z. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"annotate": null, "base": "..", "features": ["navigation.top", "navigation.prune", "navigation.indexes", "navigation.tabs.sticky", "navigation.footer", "navigation.tracking", "navigation.instant", "navigation.instant.progress", "toc.follow", "toc.integrate"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src=../assets/javascripts/bundle.79ae519e.min.js></script> <script src=https://unpkg.com/vis-network/standalone/umd/vis-network.min.js></script> <script src=../reader-size.js></script> <script src=../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=../javascripts/giscus.js></script> <script src=../javascripts/table-expand.js></script> </body> </html>